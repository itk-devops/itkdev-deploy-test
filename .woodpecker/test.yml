when:
  - event: release

skip_clone: true

steps:
  - name: build
    image: debian
    commands:
      - echo "This is the build step"

  - name: Ansible playbook
    image: itkdev/ansible-plugin:latest
    pull: true
    settings:
      PRIVATE_KEY:
        from_secret: ssh-key
      CERT:
        from_secret: ssh-cert
      HOST:
        from_secret: host
      PATH:
        from_secret: path
      USER:
        from_secret: user
      PLAYBOOK: 'release'

  - name: Run post deploy
    image: itkdev/ansible-plugin:latest
    pull: true
    settings:
      PRIVATE_KEY:
        from_secret: ssh-key
      CERT:
        from_secret: ssh-cert
      HOST:
        from_secret: host
      PATH:
        from_secret: path
      USER:
        from_secret: user
      ACTIONS:
        - itkdev-docker-compose-server exec phpfpm bin/console cache:clear
